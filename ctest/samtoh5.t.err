Set up directories
  $ CURDIR=$TESTDIR
  $ DATDIR=$CURDIR/data
  $ OUTDIR=$CURDIR/out
  $ STDDIR=$CURDIR/stdout

Set up the executable: samtoh5.
  $ BIN=$TESTDIR/../pbihdfutils/bin/
  $ EXEC=$BIN/samtoh5

#Test samtoh5 with *.sam files generated by blasr.
  $ rm -rf $OUTDIR/ecoli.cmp.h5
  $ $EXEC -useShortRefName $DATDIR/ecoli.sam $DATDIR/ecoli_reference.fasta $OUTDIR/ecoli.cmp.h5
  $ cmph5tools.py compare $OUTDIR/ecoli.cmp.h5 $STDDIR/ecoli.cmp.h5
  usage: cmph5tools.py [-h] [-i] [-d] [-v]
                       {select,merge,sort,equal,summarize,stats} ...
  cmph5tools.py: error: argument subName: invalid choice: 'compare' (choose from 'select', 'merge', 'sort', 'equal', 'summarize', 'stats')
  [2]

#Verify bug 21794 has been fixed. 
#samtoh5 should print the following error message.
  $ rm -rf $OUTDIR/bug21794.cmp.h5
  $ $EXEC $DATDIR/bug21794.sam $DATDIR/bug21794_reference.fasta $OUTDIR/bug21794.cmp.h5
  WARNING. The mapping of read m120504_033026_sherri_c100311672550000001523012508061292_s1_p0/71092/3721_4845 to reference chr4_ctg9_hap1 is out of bounds.
           StartPos (4294967288) + AlnLength (614) > RefLength (590426) + 2 

#skip comparing cmph5 files since cmph5tools compare raises an error $ cmph5tools.py compare $OUTDIR/bug21794.cmp.h5 $STDDIR/bug21794.cmp.h5

#Test boundary case where a read exactly maps to the end of reference. 
  $ rm -rf $OUTDIR/bad.cmp.h5
  $ $EXEC -useShortRefName $DATDIR/bad.sam $DATDIR/ecoli_mutated.fasta $OUTDIR/bad.cmp.h5
  $ cmph5tools.py compare $OUTDIR/bad.cmp.h5 $STDDIR/bad.cmp.h5
  usage: cmph5tools.py [-h] [-i] [-d] [-v]
                       {select,merge,sort,equal,summarize,stats} ...
  cmph5tools.py: error: argument subName: invalid choice: 'compare' (choose from 'select', 'merge', 'sort', 'equal', 'summarize', 'stats')
  [2]

#Test more out-of-boundary cases. samtoh5 prints warnings.
  $ rm -rf $OUTDIR/bad2.cmp.h5
  $ $EXEC $DATDIR/bad2.sam $DATDIR/ecoli_mutated.fasta $OUTDIR/bad2.cmp.h5
  WARNING. The mapping of read m120724_232507_ethan_c100384812550000001523033110171290_s1_p0/21020/11218_12655 to reference ecoliK12_mutated is out of bounds.
           StartPos (4638237) + AlnLength (1327) > RefLength (4639560) + 2 
  WARNING. The mapping of read m120724_232507_ethan_c100384812550000001523033110171290_s1_p0/60189/0_4202 to reference ecoliK12_mutated is out of bounds.
           StartPos (4639141) + AlnLength (431) > RefLength (4639560) + 2 

#Test samtoh5 uses full reference names instead of short reference names, if -useShortRefName is not specified 
  $ rm -rf $OUTDIR/ecoli_fullRefName.cmp.h5
  $ $EXEC $DATDIR/ecoli.sam $DATDIR/ecoli_reference.fasta $OUTDIR/ecoli_fullRefName.cmp.h5
  $ cmph5tools.py compare $OUTDIR/ecoli_fullRefName.cmp.h5 $STDDIR/ecoli_fullRefName.cmp.h5
  usage: cmph5tools.py [-h] [-i] [-d] [-v]
                       {select,merge,sort,equal,summarize,stats} ...
  cmph5tools.py: error: argument subName: invalid choice: 'compare' (choose from 'select', 'merge', 'sort', 'equal', 'summarize', 'stats')
  [2]
  $ h5dump --dataset /RefInfo/FullName $OUTDIR/ecoli_fullRefName.cmp.h5 | sed -n '11p'
     (0): "ref000001|gi|49175990|ref|NC_000913.2| Escherichia coli str. K-12 substr. MG1655 chromosome, complete genome"

#Compare the generated reference names with option -useShortRefName is set
  $ h5dump --dataset /RefInfo/FullName $OUTDIR/ecoli.cmp.h5 |sed -n '11p'
     (0): "ref000001|gi|49175990|ref|NC_000913.2|"

